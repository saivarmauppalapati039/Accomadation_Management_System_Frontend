<!-- admin-bookings.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Manage Bookings</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    .card { background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 25px; }
    h1, h2 { color: #1976d2; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f5f5f5; }
    .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; margin: 2px; }
    .btn-success { background: #4CAF50; color: white; }
    .btn-warning { background: #FF9800; color: white; }
    .btn-danger { background: #f44336; color: white; }
    .status-confirmed { color: #1976d2; }
    .status-checked_in { color: #4CAF50; }
    .status-checked_out { color: #9e9e9e; }
    .status-cancelled { color: #f44336; }
    .back-link { display: inline-block; margin-bottom: 20px; color: #1976d2; text-decoration: none; }
  </style>
</head>
<body>
  <div class="container">
    <a href="dashboard.html" class="back-link">← Back to Dashboard</a>
    <h1>Manage Bookings</h1>

    <div class="card">
      <table id="bookingsTable">
        <thead>
          <tr>
            <th>Guest</th>
            <th>Room</th>
            <th>Dates</th>
            <th>Total</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="bookingsBody">
          <tr><td colspan="6">Loading bookings...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    async function loadBookings() {
      const res = await fetch('https://accomadation-management-system-backend.onrender.com/api/bookings', { headers: {'Authorization': `Bearer ${localStorage.getItem('token')}`} });
      const bookings = await res.json();
      const tbody = document.getElementById('bookingsBody');
      tbody.innerHTML = '';
      
      if (bookings.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No bookings found.</td></tr>';
        return;
      }

      bookings.forEach(booking => {
        const row = document.createElement('tr');
        const statusClass = `status-${booking.status}`;
        row.innerHTML = `
          <td>${booking.user?.name || '—'}</td>
          <td>${booking.room?.number || '—'}</td>
          <td>${booking.checkIn} → ${booking.checkOut}</td>
          <td>₹${booking.totalAmount}</td>
          <td><span class="${statusClass}">${booking.status}</span></td>
          <td>
            <button class="btn btn-success" onclick="updateStatus('${booking.id}', 'checked_in')">Check-in</button>
            <button class="btn btn-warning" onclick="updateStatus('${booking.id}', 'checked_out')">Check-out</button>
            <button class="btn btn-danger" onclick="updateStatus('${booking.id}', 'cancelled')">Cancel</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function updateStatus(bookingId, newStatus) {
      if (!confirm(`Set status to "${newStatus}"?`)) return;
      
      await fetch(`https://accomadation-management-system-backend.onrender.com/api/bookings/${bookingId}/status`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
          },
        
        body: JSON.stringify({ status: newStatus })
      });
      loadBookings();
    }

    loadBookings();
  </script>
</body>
</html>